generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id           String            @id @default(uuid())
  email        String?           @unique
  phone        String?           @unique
  passwordHash String
  accountType  AccountType
  role         UserRole          @default(USER)
  isVerified   Boolean           @default(false)
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
  username     String?           @unique
  otps         OtpVerification[]
  profile      Profile?
  wallet       Wallet?
}

model OtpVerification {
  id        String   @id @default(uuid())
  userId    String?
  email     String?
  phone     String?
  otpHash   String
  expiresAt DateTime
  attempts  Int      @default(0)
  createdAt DateTime @default(now())
  user      User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Profile {
  id           String         @id @default(uuid())
  userId       String         @unique
  firstName    String
  lastName     String
  bio          String?
  location     String?
  avatarUrl    String?
  isAuto       Boolean        @default(false)
  isVerified   Boolean        @default(false)
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  certificates Certificate[]
  experiences  Experience[]
  links        ExternalLink[]
  user         User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  skills       ProfileSkill[]
  reviews      Review[]
  services     Service[]
}

model Skill {
  id       String         @id @default(uuid())
  name     String         @unique
  profiles ProfileSkill[]
}

model ProfileSkill {
  profileId String
  skillId   String
  profile   Profile @relation(fields: [profileId], references: [id], onDelete: Cascade)
  skill     Skill   @relation(fields: [skillId], references: [id], onDelete: Cascade)

  @@id([profileId, skillId])
}

model Experience {
  id          String    @id @default(uuid())
  profileId   String
  title       String
  description String?
  startDate   DateTime?
  endDate     DateTime?
  profile     Profile   @relation(fields: [profileId], references: [id], onDelete: Cascade)
}

model Certificate {
  id        String  @id @default(uuid())
  profileId String
  name      String
  fileUrl   String
  verified  Boolean @default(false)
  profile   Profile @relation(fields: [profileId], references: [id], onDelete: Cascade)
}

model Category {
  id       String    @id @default(uuid())
  name     String    @unique
  services Service[]
}

model Service {
  id          String   @id @default(uuid())
  profileId   String
  categoryId  String
  title       String
  description String?
  priceFrom   Float?
  priceTo     Float?
  category    Category @relation(fields: [categoryId], references: [id])
  profile     Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)
}

model Review {
  id         String   @id @default(uuid())
  reviewerId String
  profileId  String
  rating     Int
  comment    String?
  createdAt  DateTime @default(now())
  profile    Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)
}

model Conversation {
  id        String    @id @default(uuid())
  createdAt DateTime  @default(now())
  messages  Message[]
}

model Message {
  id             String       @id @default(uuid())
  conversationId String
  senderId       String
  content        String
  createdAt      DateTime     @default(now())
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
}

model Wallet {
  id           String        @id @default(uuid())
  userId       String        @unique
  balance      Float         @default(0)
  transactions Transaction[]
  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Transaction {
  id        String   @id @default(uuid())
  walletId  String
  amount    Float
  type      String
  createdAt DateTime @default(now())
  wallet    Wallet   @relation(fields: [walletId], references: [id], onDelete: Cascade)
}

model ExternalLink {
  id        String  @id
  profileId String
  type      String
  url       String
  profile   Profile @relation(fields: [profileId], references: [id], onDelete: Cascade)
}

enum AccountType {
  PROFESSIONAL
  COMPANY
  STUDENT
  NHONGUISTA
  FREELANCER
}

enum UserRole {
  USER
  ADMIN
}
